<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LanHub - Script Library</title>
<style>
  :root{
    --bg-1:#0b0010; --bg-2:#190024; --card:#170022;
    --accent:#a855f7; --accent-2:#c293ff; --muted:#9b9b9b;
    --purple:#6b21a8; --btn-hover:#9333ea;
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:Montserrat,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  html,body{height:100%}
  body{
    min-height:100vh;background:linear-gradient(160deg,var(--bg-1),var(--bg-2));
    color:#fff;padding:18px;display:flex;flex-direction:column;align-items:center;
  }

  header{width:100%;max-width:720px;margin-bottom:14px}
  h1{font-size:20px;color:var(--accent-2);text-align:left;text-shadow:0 0 10px var(--accent);letter-spacing:1px}

  .top-controls{display:flex;gap:8px;align-items:center;margin:10px 0 18px 0;width:100%;max-width:720px}
  .search-wrap{flex:1}
  .search-wrap input{
    width:100%;padding:12px 14px;border-radius:12px;border:0;background:rgba(50,0,70,0.6);color:#fff;
    outline:none;font-size:15px;box-shadow:0 0 8px rgba(168,85,247,0.04);
  }
  .search-wrap input:focus{box-shadow:0 0 14px rgba(168,85,247,0.12)}
  .select-cat{
    margin-left:8px;padding:10px;border-radius:12px;border:0;background:rgba(80,0,150,0.45);color:#fff;
    font-size:14px;min-width:120px;
  }

  .grid{width:100%;max-width:720px;display:flex;flex-direction:column;gap:14px}

  .card{
    background:linear-gradient(180deg,rgba(30,0,40,0.7),rgba(22,0,34,0.85));
    border:1px solid rgba(168,85,247,0.18);padding:12px;border-radius:14px;backdrop-filter: blur(6px);
    display:flex;flex-direction:column;gap:8px;box-shadow:0 4px 18px rgba(0,0,0,0.35);
  }

  .thumb{
    width:100%;height:170px;border-radius:10px;overflow:hidden;background:linear-gradient(135deg,#3a0060,#6b21a8);
    display:flex;align-items:center;justify-content:center;color:var(--accent-2);font-weight:700;letter-spacing:2px;
  }
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}

  .meta{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .meta .left{display:flex;flex-direction:column}
  .meta h2{font-size:16px;color:#e6ccff;margin-bottom:4px}
  .meta .sub{font-size:13px;color:var(--muted)}

  .actions{display:flex;gap:8px;margin-top:6px}
  .btn{flex:1;padding:10px;border-radius:10px;border:0;background:var(--purple);color:#fff;font-weight:700;cursor:pointer}
  .btn:hover{background:var(--btn-hover);transform:translateY(-2px);box-shadow:0 6px 20px rgba(147,51,234,0.14)}

  .status{font-size:13px;color:#8ef59f;margin-top:6px}

  footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center;width:100%;max-width:720px;padding-bottom:10px}

  /* Popup small box (Anti bypass check + service select) */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;z-index:9999}
  .popup{
    width:90%;max-width:360px;background:#120018;border-radius:12px;padding:18px;border:1px solid rgba(168,85,247,0.24);
    box-shadow:0 10px 40px rgba(10,0,20,0.6);text-align:center;color:#fff;
  }
  .popup h3{color:var(--accent-2);margin-bottom:8px}
  .popup p{color:#ddd;font-size:14px;margin-bottom:12px}
  .popup .popup-row{display:flex;gap:8px;justify-content:center;margin-bottom:10px}
  .popup .popup-row button{flex:1;padding:10px;border-radius:8px;border:0;background:var(--purple);color:#fff}
  .popup .small-muted{font-size:12px;color:#b6b6b6;margin-top:8px}

  /* Anti-bypass checking box style */
  .checking-box{display:flex;align-items:center;gap:12px;justify-content:center;flex-direction:column}
  .spinner{width:48px;height:48px;border-radius:50%;border:4px solid rgba(255,255,255,0.06);border-top-color:var(--accent);animation:spin 0.9s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* Toast */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:22px;background:#0d0014;padding:10px 14px;border-radius:10px;border:1px solid rgba(168,85,247,0.16);color:#fff;z-index:12000}

  /* responsive */
  @media (min-width:720px){
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px}
  }
</style>
</head>
<body>

<header>
  <h1>LanHub Script Library</h1>
  <div class="top-controls">
    <div class="search-wrap">
      <input id="searchInput" placeholder="ðŸ” Search scripts..." oninput="filterScripts()" />
    </div>
    <select id="catSelect" class="select-cat" onchange="filterScripts()">
      <option value="all">All categories</option>
      <!-- categories added at runtime -->
    </select>
  </div>
</header>

<main class="grid" id="grid"></main>

<footer>Â© 2025 LanHub â€” All Rights Reserved.</footer>

<!-- Overlay container (single, won't duplicate) -->
<div id="overlayRoot" style="display:none"></div>

<!-- Toast root -->
<div id="toastRoot"></div>

<script>
/* ========== CONFIG ========== */
/* Anti-bypass settings (mode A chosen) */
const BYPASS_THRESHOLD_MS = 3000; // < 3s => bypass
const LOCK_DURATION_MS = 60000; // 60s lock on bypass

/* ========== Data (example) ========== */
/* Fill per-script direct-link per script in data.directLink */
const scriptsData = [
  {
    id: "entrenchedww1",
    name: "Entrenched WW1",
    created: "Oct 2025",
    category: "Shooter",
    gameLink: "https://www.roblox.com/games/3678761576/ENTRENCHED-WW1", // example
    directLink: "https://direct-link.net/1321138/ajnMHzXvEJoy", // unique per script
    script: `-- Entrenched WW1 loader
loadstring(game:HttpGet("https://raw.githubusercontent.com/Wrate/Entrenched-Ww1/main/Main.loader"))()`
  },
  {
    id: "forest99",
    name: "99 Night In The Forest",
    created: "Nov 2025",
    category: "Adventure",
    gameLink: "https://www.roblox.com/games/16898830773/99-Night-In-The-Forest",
    directLink: "https://direct-link.net/1321138/ajnMHzXvEJy",
    script: `-- 99 Night In The Forest sample script
print("LanHub: 99 Night In The Forest loaded!")`
  }
];

/* ========== State ========== */
const grid = document.getElementById('grid');
const overlayRoot = document.getElementById('overlayRoot');
const toastRoot = document.getElementById('toastRoot');
let pendingAction = null; // {id, action, startRedirectAt}
let lockedUntil = 0; // timestamp ms when lock expires

/* Utility: toast */
function toast(msg, dur=1500){
  const t = document.createElement('div');
  t.className = 'toast'; t.innerText = msg; toastRoot.appendChild(t);
  setTimeout(()=>{ t.remove(); }, dur);
}

/* Extract gameId from gameLink (roblox) */
function getGameIdFromLink(link){
  if (!link) return null;
  try{
    // possible formats: /games/{id}/..., /games/{id}
    const m = link.match(/\/games\/(\d+)/);
    if (m) return m[1];
    const m2 = link.match(/\/catalog\/\?id=(\d+)/);
    if (m2) return m2[1];
  }catch(e){}
  return null;
}

/* Build thumbnail url (roblox asset-thumbnail) */
function thumbnailUrlFromGameLink(link){
  const id = getGameIdFromLink(link);
  if (!id) return null;
  return `https://www.roblox.com/asset-thumbnail/image?assetId=${id}&width=420&height=420&format=Png`;
}

/* Render UI cards */
function renderCards(){
  grid.innerHTML = '';
  // collect categories
  const cats = new Set(['all']);
  scriptsData.forEach(s=>cats.add(s.category));
  // populate category select if empty
  const sel = document.getElementById('catSelect');
  if (sel.options.length <= 1){
    // clear extras
    while(sel.options.length>1) sel.remove(1);
    Array.from(cats).filter(c=>c!=='all').forEach(c=>{
      const o = document.createElement('option'); o.value=c; o.innerText=c; sel.appendChild(o);
    });
  }

  scriptsData.forEach(data=>{
    const card = document.createElement('div'); card.className='card';
    // thumb
    const thumbDiv = document.createElement('div'); thumbDiv.className='thumb';
    const thumbUrl = thumbnailUrlFromGameLink(data.gameLink);
    if (thumbUrl){
      const img = document.createElement('img'); img.src = thumbUrl;
      img.alt = data.name + ' thumbnail';
      img.onerror = ()=>{ thumbDiv.innerText = 'BETA'; }
      thumbDiv.appendChild(img);
    } else {
      thumbDiv.innerText = 'BETA';
    }
    // meta
    const meta = document.createElement('div'); meta.className='meta';
    const left = document.createElement('div'); left.className='left';
    const h2 = document.createElement('h2'); h2.innerText = data.name;
    const sub = document.createElement('div'); sub.className='sub'; sub.innerText = `${data.created} â€¢ ${data.category}`;
    left.appendChild(h2); left.appendChild(sub);
    meta.appendChild(left);
    // actions
    const actions = document.createElement('div'); actions.className='actions';
    const btnRaw = document.createElement('button'); btnRaw.className='btn'; btnRaw.innerText='Raw';
    btnRaw.onclick = ()=> handleActionRequest(data.id, 'raw', btnRaw);
    const btnCopy = document.createElement('button'); btnCopy.className='btn'; btnCopy.innerText='Copy';
    btnCopy.onclick = ()=> handleActionRequest(data.id, 'copy', btnCopy);
    const btnDownload = document.createElement('button'); btnDownload.className='btn'; btnDownload.innerText='Download';
    btnDownload.onclick = ()=> handleActionRequest(data.id, 'download', btnDownload);
    const btnGame = document.createElement('button'); btnGame.className='btn'; btnGame.innerText='Game';
    btnGame.onclick = ()=> {
      // open game link
      if (data.gameLink) window.open(data.gameLink, '_blank');
      else toast('No game link',1000);
    };
    actions.appendChild(btnRaw); actions.appendChild(btnCopy); actions.appendChild(btnDownload); actions.appendChild(btnGame);

    // status
    const stat = document.createElement('div'); stat.className='status';
    stat.innerText = isUnlockedReady(data.id) ? 'Unlocked â€” ready' : 'Locked';
    stat.dataset.id = data.id;

    card.appendChild(thumbDiv); card.appendChild(meta); card.appendChild(actions); card.appendChild(stat);
    card.dataset.name = data.name.toLowerCase();
    card.dataset.category = data.category;
    grid.appendChild(card);
  });
}

/* Check if unlocked ready - for demo we simply check not locked; can be extended */
function isUnlockedReady(id){
  // placeholder: always ready unless global lock
  return Date.now() > lockedUntil;
}

/* Filter search + category */
function filterScripts(){
  const q = (document.getElementById('searchInput').value||'').toLowerCase().trim();
  const cat = (document.getElementById('catSelect').value||'all');
  const cards = grid.querySelectorAll('.card');
  cards.forEach(c=>{
    const name = c.dataset.name || '';
    const ccat = c.dataset.category || '';
    const matchQ = !q || name.includes(q);
    const matchC = cat === 'all' || ccat === cat;
    c.style.display = (matchQ && matchC) ? '' : 'none';
  });
}

/* ========== Action flow ========== */
/* handleActionRequest: prepare pendingAction and show service popup */
function handleActionRequest(id, action, btnEl){
  if (Date.now() < lockedUntil){
    const sec = Math.ceil((lockedUntil - Date.now())/1000);
    toast(`Anti-bypass lock active: ${sec}s`, 2200);
    return;
  }

  const data = scriptsData.find(s=>s.id===id);
  if (!data) return toast('Script not found',1200);

  // set pending
  pendingAction = { id, action, btnEl, startRedirectAt:0, step:'select-service' };

  // show small service popup (type B)
  showServicePopup(data);
}

/* showServicePopup: small popup with service choices (we only include Direct Link for now) */
function showServicePopup(data){
  removeOverlay();
  const ov = document.createElement('div'); ov.className='overlay'; ov.id='lanhub-overlay';
  const p = document.createElement('div'); p.className='popup';
  p.innerHTML = `<h3>Choose Unlock Method</h3>
    <p>Select Direct Link to unlock this script. After completion, return to this page and press "I've returned" (or switch back to this tab).</p>
    <div class="popup-row">
      <button id="directBtn">Direct Link</button>
      <button id="cancelBtn" style="background:#3a004f">Cancel</button>
    </div>
    <div class="small-muted">Service: DirectLink (per-script)</div>`;

  ov.appendChild(p); overlayRoot.style.display='block'; overlayRoot.appendChild(ov);

  document.getElementById('directBtn').onclick = ()=>{
    // open direct link in new tab and start checking
    if (!data.directLink){
      toast('No directLink configured for this script',1600);
      closeOverlay();
      return;
    }
    // record redirect start
    pendingAction.startRedirectAt = Date.now();
    pendingAction.step = 'redirected';
    // open external link
    window.open(data.directLink, '_blank');
    // replace popup with checking UI
    showCheckingPopup();
    // attach focus/visibility listeners to auto-detect return
    attachReturnListeners();
  };

  document.getElementById('cancelBtn').onclick = ()=>{
    pendingAction = null;
    closeOverlay();
  };
}

/* showCheckingPopup: small anti-bypass checking UI */
function showCheckingPopup(){
  removeOverlay();
  const ov = document.createElement('div'); ov.className='overlay'; ov.id='lanhub-overlay';
  const p = document.createElement('div'); p.className='popup';
  p.innerHTML = `<h3>LanHub Anti Bypass Detection</h3>
    <div class="checking-box">
      <div class="spinner"></div>
      <p>Checking unlock... please return after completing the unlock page.</p>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button id="returnedBtn" style="flex:1;background:#2f6f2f">I've returned</button>
        <button id="abortBtn" style="flex:1;background:#4a1d4a">Abort</button>
      </div>
      <div class="small-muted">This protects against automated bypass. If you bypass, UI will be locked 60s.</div>
    </div>`;
  ov.appendChild(p); overlayRoot.style.display='block'; overlayRoot.appendChild(ov);

  document.getElementById('returnedBtn').onclick = ()=> handleReturn();
  document.getElementById('abortBtn').onclick = ()=> { pendingAction = null; detachReturnListeners(); closeOverlay(); };
}

/* attach listeners to detect user returning (visibilitychange and focus) */
let _visHandler = null, _focusHandler = null;
function attachReturnListeners(){
  _visHandler = ()=>{ if (!document.hidden) { handleReturn(); } };
  _focusHandler = ()=>{ handleReturn(); };
  document.addEventListener('visibilitychange', _visHandler);
  window.addEventListener('focus', _focusHandler);
}

/* detach listeners */
function detachReturnListeners(){
  if (_visHandler) document.removeEventListener('visibilitychange', _visHandler);
  if (_focusHandler) window.removeEventListener('focus', _focusHandler);
  _visHandler = null; _focusHandler = null;
}

/* handleReturn: user returned -> validate time */
function handleReturn(){
  if (!pendingAction || pendingAction.step!=='redirected') return;
  detachReturnListeners();
  const now = Date.now();
  const elapsed = now - (pendingAction.startRedirectAt || now);
  // if elapsed < threshold => bypass
  if (elapsed < BYPASS_THRESHOLD_MS){
    // lock UI
    lockedUntil = Date.now() + LOCK_DURATION_MS;
    closeOverlay();
    toast('Bypass detected â€” UI locked for 60s', 2500);
    // update statuses visually
    updateStatuses();
    pendingAction = null;
    return;
  }
  // success
  closeOverlay();
  toast('Unlock confirmed â€” performing action...', 1400);
  // perform pending action after short delay
  setTimeout(()=> performPendingAction(pendingAction), 700);
}

/* performPendingAction executes raw/copy/download */
function performPendingAction(p){
  if (!p) return;
  const data = scriptsData.find(s=>s.id===p.id);
  if (!data) { toast('Script data missing',1200); return; }

  if (p.action === 'raw'){
    // open raw script in new window (safe)
    const w = window.open('', '_blank');
    const safeCode = escapeHtml(data.script);
    w.document.write(`<body style="background:#0a0012;color:#fff;padding:18px;font-family:monospace;"><h2 style="color:${'#c293ff'};">LanHub Raw - ${escapeHtml(data.name)}</h2><pre style="background:#120016;padding:12px;border-radius:10px;color:#fff;">${safeCode}</pre></body>`);
    w.document.title = `LanHub - ${data.name} (raw)`;
  } else if (p.action === 'copy'){
    navigator.clipboard.writeText(data.script).then(()=> {
      toast('Script copied to clipboard âœ…',1400);
    }).catch(()=> {
      toast('Copy failed',1200);
    });
  } else if (p.action === 'download'){
    const blob = new Blob([data.script], {type:'text/plain'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${data.name.replace(/\s+/g,'_')}.txt`;
    document.body.appendChild(a); a.click(); a.remove();
    toast('Download started',1200);
  }
  pendingAction = null;
}

/* remove overlay */
function removeOverlay(){
  overlayRoot.innerHTML = ''; overlayRoot.style.display='none';
}

/* close overlay wrapper */
function closeOverlay(){ removeOverlay(); detachReturnListeners(); }

/* escapeHtml helper for raw display */
function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* update statuses (locked or ready) */
function updateStatuses(){
  const statuses = document.querySelectorAll('.status');
  statuses.forEach(st=>{
    const id = st.dataset.id;
    st.innerText = (Date.now() > lockedUntil) ? 'Unlocked â€” ready' : `Locked until ${Math.ceil((lockedUntil-Date.now())/1000)}s`;
  });
}

/* Periodic UI updates */
setInterval(updateStatuses, 800);

/* initial render */
renderCards();
filterScripts();

</script>
</body>
</html>
